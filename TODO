/var/lib/denyhosts/restricted-usernames is a useful file that you can fill up with user names like "sales" or "guest" and anyone who tries to log in as these users will be denied rapidly. Denyhost itself does not modify the contents of that file. Therefore, it functions as a configuration file. Therefore, it should be in /etc .

I've been annoyed by this a few times when installing a new version of linux. I keep a copy of /etc/ and I always lose my list of usernames for denyhost. Then I have to go back to looking at /var/log/auth.log to recreate it by looking at failed login attempts.
https://bugs.launchpad.net/ubuntu/+source/denyhosts/+bug/675034




On a debian system a successful ssh login is recorded like this in auth.log:

May 14 09:57:40 mybox sshd[30973]: Accepted password for joe from 1.15.16.24 port 57633 ssh2

But regex.py is looking for:

SUCCESSFUL_ENTRY_REGEX = re.compile(r"""Accepted (?P<method>\S+) for (?P<user>.*?) from (::ffff:)?(?P<host>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})$""")

which does not match because of the 'port' etc after the IP address.

This is easily fixed, with this regex instead:
SUCCESSFUL_ENTRY_REGEX = re.compile(r"""Accepted (?P<method>\S+) for (?P<user>.*?) from (::ffff:)?(?P<host>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})( port \d+)?( ssh2)?$""")

See also #734329.
Looking back at that bug made me wonder about the (?P<user>.*?) element
of the regex. Should it be (?P<user>.*) instead?
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=748080



1) Edit /var/lib/denyhosts/sync-timestamp, and replace the timestamp with a valid unix timestamp. (I used 1276467300 )

2) At line 55 in /usr/share/denyhosts/DenyHosts/sync.py, I made the following change

from
fp = open(os.path.join(self.__work_dir,
SYNC_TIMESTAMP), "a")

to
fp = open(os.path.join(self.__work_dir,
SYNC_TIMESTAMP), "w")
https://bugs.launchpad.net/ubuntu/+source/denyhosts/+bug/564476




Fix pattern matching in auth file.
Possible fix: https://bugs.debian.org/cgi-bin/bugreport.cgi?msg=19;filename=wheezy-0001-propose-fix-for-734329.patch;att=1;bug=734329
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=734329

